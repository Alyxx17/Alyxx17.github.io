---
title: 无约束MPC基本原理
date: 2026-02-05 10:00:00 +0800
categories: [控制,MPC]
tags: [控制]
math: true  # <-- 就是这一行，启用本页的数学公式渲染
---

## 核心原理
MPC控制的基本原理可以概括为：在每个采样时刻用最新得到的测量值刷新优化问题，并求解刷新后的优化问题,将得到的优化解（可能只是次优解）的第一个分量 u*(k|k)作用于系统,如此循环往复至永远。
换句话说，预测控制算法包括三个步骤：  

（1）预测系统未来动态:  

（2）(数值) 求解优化问题;  

（3） 将优化解的第一个元素 (或者说一部分)作用于系统；  

实际上通俗来说，MPC预测控制有点类似于下棋：根据当前时刻的状态预测推演接下来的几步，但是只下一步，如此往复。  
## 增量离散状态空间模型

考虑如下连续时间域的状态空间方程:  

$$
\begin{aligned}
\dot{x}(t) &= A_c x(t) + B_{cu} u(t) + B_{cd} d(t); \\
y_c(t) &= C_c x(t).
\end{aligned}
$$  

其中$x(t)$是状态变量，$u(t)$是控制输入变量，$d(t)$是可以测量的外部干扰变量， $y_c$ 是被控输出变量;  

为了便于计算机控制，将上述连续时间域的状态空间方程转化为离散时间域的状态空间方程。其系数有如下关系：  

\begin{aligned}
A & =\mathrm{e}^{A_{c} T_{s}} 
\end{aligned}  

\begin{aligned}
B_{u} & =\int_{0}^{T_{s}} \mathrm{e}^{A_{c} \tau} \mathrm{~d} \tau \cdot B_{c u}
\end{aligned}  

\begin{aligned}
B_{d} & =\int_{0}^{T_{s}} \mathrm{e}^{A_{c} \tau} \mathrm{~d} \tau \cdot B_{c d}
\end{aligned}  
其中Ts为采样时间。  
因此，离散域的状态空间方程可以表示为:  

$$
\begin{aligned}
x(k+1) &= Ax(k) + B_u u(k) + B_d d(k); \\
y_c(k) &= C_c x(k).
\end{aligned}
$$  

为了引入积分作用以减小或消除静态误差，采用增量离散状态空间模型。  
定义:
\begin{aligned}
Δx(k) &= x(k)-x(k-1);
\end{aligned}  

\begin{aligned}
Δu(k) &= u(k)-u(k-1);
\end{aligned}  

\begin{aligned}
Δd(k) &= d(k)-d(k-1);
\end{aligned}  

由此可得增量离散状态空间模型为：  

$$
\begin{aligned}
\Delta x(k+1) &= A \Delta x(k) + B_u \Delta u(k) + B_d \Delta d(k); \\
y_c(k) &= C_c \Delta x(k) + y_c(k-1).
\end{aligned}
$$  

本文以后的推导都基于这个增量离散状态空间模型（下称“状态空间模型”）。  
## 预测方程  
这一节将讨论MPC的第一个步骤：基于上述的状态空间模型预测系统未来的动态。  
假设所有状态变量均可测量，以最新的测量值为初始条件，设置预测时域为$p$，控制时域为$m$，且$m$≤$p$。为了便于推导，作如下假设：  
(1)控制时域之外，控制量不变，即$Δu(k+i)$=$0$,$i$=$m$,$m+1$,......,$p-1$;  

(2)可测干扰在k时刻之后保持不变，即$Δd(k+i)$=$0$,$i$=$1$,$2$,......,$p$;  


基于这两个假设，先预测状态变量，在当前时刻$k$,测量值为$x(k)$,可以计算$Δx(k)=x(k)-x(k-1)$，这个$Δx(k)$将作为预测系统未来状态的起点。式中$k+i|k$代表从$k$开始预测到$k+i$时刻。即：  

$$
\begin{aligned}
\Delta x(k+1|k) &= A\Delta x(k) + B_u\Delta u(k) + B_d\Delta d(k), \\
\Delta x(k+2|k) &= A\Delta x(k+1|k) + B_u\Delta u(k+1) + B_d\Delta d(k+1) \\
&= A^2\Delta x(k) + AB_u\Delta u(k) + B_u\Delta u(k+1) + AB_d\Delta d(k), \\
\Delta x(k+3|k) &= A\Delta x(k+2|k) + B_u\Delta u(k+2) + B_d\Delta d(k+2) \\
&= A^3\Delta x(k) + A^2B_u\Delta u(k) + AB_u\Delta u(k+1) + B_u\Delta u(k+2) + A^2B_d\Delta d(k).
\end{aligned}
$$ 

$$
\vdots
$$



$$
\begin{aligned}
\Delta x(k + m|k) &= A\Delta x(k + m - 1|k) + B_u \Delta u(k + m - 1) + B_d \Delta d(k + m - 1) \\
&= A^m \Delta x(k) + A^{m-1} B_u \Delta u(k) + A^{m-2} B_u \Delta u(k + 1) \\
&\quad + \cdots + B_u \Delta u(k + m - 1) + A^{m-1} B_d \Delta d(k), \\
&\vdots \\
\Delta x(k + p|k) &= A\Delta x(k + p - 1|k) + B_u \Delta u(k + p - 1) + B_d \Delta d(k + p - 1) \\
&= A^p \Delta x(k) + A^{p-1} B_u \Delta u(k) + A^{p-2} B_u \Delta u(k + 1) \\
&\quad + \cdots + A^{p-m} B_u \Delta u(k + m - 1) + A^{p-1} B_d \Delta d(k).
\end{aligned}
$$  

进一步，利用上面预测的状态，可以预测被控输出： 

$$
\begin{aligned}
y_c(k+1|k) &= C_c \Delta x(k+1|k) + y_c(k) \\
&= C_c A \Delta x(k) + C_c B_u \Delta u(k) + C_c B_d \Delta d(k) + y_c(k), \\
y_c(k+2|k) &= C_c \Delta x(k+2|k) + y_c(k+1|k) \\
&= (C_c A^2 + C_c A) \Delta x(k) + (C_c AB_u + C_c B_u) \Delta u(k) \\
&\quad + C_c B_u \Delta u(k+1) + (C_c AB_d + C_c B_d) \Delta d(k) + y_c(k), \\
&\vdots \\
y_c(k+m|k) &= C_c \Delta x(k+m|k) + y_c(k+m-1|k) \\
&= \sum_{i=1}^m C_c A^i \Delta x(k) + \sum_{i=1}^m C_c A^{i-1} B_u \Delta u(k) \\
&\quad + \sum_{i=1}^{m-1} C_c A^{i-1} B_u \Delta u(k+1) + \cdots + C_c B_u \Delta u(k+m-1) \\
&\quad + \sum_{i=1}^m C_c A^{i-1} B_d \Delta d(k) + y_c(k), \\
&\vdots \\
y_c(k+p|k) &= C_c \Delta x(k+p|k) + y_c(k+p-1|k) \\
&= \sum_{i=1}^p C_c A^i \Delta x(k) + \sum_{i=1}^p C_c A^{i-1} B_u \Delta u(k) \\
&\quad + \sum_{i=1}^{p-1} C_c A^{i-1} B_u \Delta u(k+1) + \dots \\
&\quad + \sum_{i=1}^{p-m+1} C_c A^{i-1} B_u \Delta u(k+m-1) \\
&\quad + \sum_{i=1}^p C_c A^{i-1} B_d \Delta d(k) + y_c(k).
\end{aligned}
$$  

定义$p$步预测输出向量和$m$步输入向量如下:  

$$ 
\begin{aligned}
Y_p(k+1|k) \stackrel{\text{def}}{=}
  \begin{pmatrix}
  y_c(k+1|k) \\
  y_c(k+2|k) \\
  \vdots \ \\
  y_c(k+p|k) \\
  \end{pmatrix}_{p \times 1}
\end{aligned}  
$$  

$$
\begin{aligned}
\Delta U(k) \stackrel{\text{def}}{=}
\begin{bmatrix}
\Delta u(k) \\
\Delta u(k+1) \\
\vdots \\
\Delta u(k+m-1)
\end{bmatrix}_{m \times 1}.
\end{aligned}
$$  

注意：矩阵下标表示的是矩阵中向量 (或标量)的个数,不一定是矩阵的维数. 例如,上式中, $p×1$仅表示$Y_p(k+1|k)$ 矩阵中$y_c$的个数, 当$y_c$是向量时,$px1$并不等于矩阵的维数.  

同时需要注意的是$k$时刻的$u(k)$不是已知量，而是需要施加到系统的第一个控制量。因此$Δu(k)$不是初始条件。  

那么, 根据上面的预测推导，可以各步矩阵系数增广组合，对系统未来$p$步预测的输出可以由下面的预测方程计算:  

$$
\begin{aligned}
Y_p(k + 1|k) = S_x \Delta x(k) + I y_c(k) + S_d \Delta d(k) + S_u \Delta U(k),
\end{aligned}
$$

其中：  

$$
\begin{aligned}
S_x = 
\begin{bmatrix}
C_c A \\
\sum_{i=1}^{2} C_c A^i \\
\vdots \\
\sum_{i=1}^{p} C_c A^i
\end{bmatrix}_{p \times 1}, \quad I =
\begin{bmatrix}
I_{n_c \times n_c} \\
I_{n_c \times n_c} \\
\vdots \\
I_{n_c \times n_c}
\end{bmatrix}_{p \times 1},
\end{aligned}
$$  

$I_{n_c \times n_c}$中的下标代表输出维数，即$C_c$的行数。

$$
\begin{aligned}
S_d =
\begin{bmatrix}
C_c B_d \\
\sum_{i=1}^2 C_c A^{i-1} B_d \\
\vdots \\
\sum_{i=1}^p C_c A^{i-1} B_d
\end{bmatrix}_{p \times 1},
\end{aligned}
$$  

$$
\begin{aligned}
S_u =
\begin{bmatrix}
C_c B_u & 0 & 0 & \cdots & 0 \\
\sum_{i=1}^2 C_c A^{i-1} B_u & C_c B_u & 0 & \cdots & 0 \\
\vdots & \vdots & \vdots & \ddots & \vdots \\
\sum_{i=1}^m C_c A^{i-1} B_u & \sum_{i=1}^{m-1} C_c A^{i-1} B_u & \cdots &  \cdots &C_c B_u \\
\vdots & \vdots & \vdots & \ddots & \vdots \\
\sum_{i=1}^p C_c A^{i-1} B_u & \sum_{i=1}^{p-1} C_c A^{i-1} B_u & \cdots & \cdots &\sum_{i=1}^{p-m+1} C_c A^{i-1} B_u
\end{bmatrix}_{p \times m}
\end{aligned}
$$

$S_u$中前$m$行构成的下三角矩阵，很好的说明了系统在时间上的因果关系。比如第一行只有$Δu(k)$的系数不为$0$，$Δu(k+1)$，$Δu(k+2)$......的系数都为0，而这行也对应了$y_c(k+1|k)$，而第二行只有$Δu(k)$，$Δu(k)$的系数不为$0$,这行对应了$y_c(k+2|k)$，说明$k+1$时刻的输入对$$k时刻的输出没有影响，$k+2$时刻的输入对$k$，$k+1$时刻的输出没有影响，以此类推。
为了更好的理解$S_u$矩阵，$S_u$可以表示为如下形式(假设$p=20$,$m=5$):  

$$
\begin{aligned}
S_u = 
\begin{bmatrix}
h_1 & 0 & 0 & 0 & 0 \\
h_2 & h_1 & 0 & 0 & 0 \\
h_3 & h_2 & h_1 & 0 & 0 \\
h_4 & h_3 & h_2 & h_1 & 0 \\
h_5 & h_4 & h_3 & h_2 & h_1 \\
h_6 & h_5 & h_4 & h_3 & h_2 \\
h_7 & h_6 & h_5 & h_4 & h_3 \\
h_8 & h_7 & h_6 & h_5 & h_4 \\
h_9 & h_8 & h_7 & h_6 & h_5 \\
h_{10} & h_9 & h_8 & h_7 & h_6 \\
h_{11} & h_{10} & h_9 & h_8 & h_7 \\
h_{12} & h_{11} & h_{10} & h_9 & h_8 \\
h_{13} & h_{12} & h_{11} & h_{10} & h_9 \\
h_{14} & h_{13} & h_{12} & h_{11} & h_{10} \\
h_{15} & h_{14} & h_{13} & h_{12} & h_{11} \\
h_{16} & h_{15} & h_{14} & h_{13} & h_{12} \\
h_{17} & h_{16} & h_{15} & h_{14} & h_{13} \\
h_{18} & h_{17} & h_{16} & h_{15} & h_{14} \\
h_{19} & h_{18} & h_{17} & h_{16} & h_{15} \\
h_{20} & h_{19} & h_{18} & h_{17} & h_{16}
\end{bmatrix}_{20\times5}
\end{aligned}
$$

其中：
$h_k = \displaystyle\sum_{i=1}^k C_c A^{i-1} B_u ，k = 1,2,\dots,p $



